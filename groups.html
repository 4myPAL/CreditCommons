<html lang="en">
<head>
<title>Groups</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet"
	href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
<script
	src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
<script type="text/javascript" src="web3.js"></script>
<script type="text/javascript" src="bignumber.js"></script>
<script type="text/javascript" src="creditCommons.js"></script>
<script type="text/javascript">
	window.onload = function() {

		document.getElementById('me').innerHTML = "ETH Account: <b>" + coinbase
				+ "<br></b> Credit Commons Member: <b>" + isMember
				+ "</b> Alias: <b>" + myAlias + "<br></b>Group ID: <b>"
				+ myGroupID + "</b> Group Name: <b>" + groupName + "</b>";
		document.getElementById('groupOwner').innerText = owner;
		document.getElementById('groupID').innerText = myGroupID;
		document.getElementById('groupName').innerText = groupName;
		document.getElementById('currency').innerText = currencyName;
		document.getElementById('rate').innerText = rate + " " + currencyName;
		document.getElementById('debitLimitG').innerText = debitLimit + " "
				+ currencyName;
		document.getElementById('creditLimitG').innerText = creditLimit + " "
				+ currencyName;
		document.getElementById('open').innerText = open;
		document.getElementById('numberG').innerHTML = "Number of groups in the system: <b>"
				+ creditCommons.getNumberGroups() + "</b>";

		var groupsList = "";
		var date;
		for (i = 0; i < creditCommons.getNumberGroups(); i++) {
			date = new Date(creditCommons.getGroupbyIndex(i) * 1000);
			groupsList += "<hr/>Created: "
					+ date
					+ "<br/>Group ID: <b>"
					+ creditCommons.getGroupbyIndex(i)
					+ "</b> Group name: <b>"
					+ creditCommons.getGroup(creditCommons.getGroupbyIndex(i))[1]
					+ "</b> Open: <b>"
					+ creditCommons.getGroup(creditCommons.getGroupbyIndex(i))[6]
					+ "</b><br>Group Owner: <b>"
					+ creditCommons.getGroup(creditCommons.getGroupbyIndex(i))[0]
					+ "</b><br>Currency name: <b>"
					+ creditCommons.getGroup(creditCommons.getGroupbyIndex(i))[2]
					+ "</b> Rate: <b>"
					+ creditCommons.getGroup(creditCommons.getGroupbyIndex(i))[3]
					+ "</b> Debit Limit: <b>"
					+ creditCommons.getGroup(creditCommons.getGroupbyIndex(i))[4]
					+ "</b> Credit Limit: <b>"
					+ creditCommons.getGroup(creditCommons.getGroupbyIndex(i))[5]
					+ "</b><br/>";

			document.getElementById('listGroups').innerHTML = groupsList;
			document.getElementById('owner_ID').innerHTML = " Owner " + owner
					+ " Group " + myGroupID;
		}

	}

	function joinGroup() {
		var groupToJ = document.getElementById('groupToJoin').value;
		creditCommons.joinGroup(groupToJ);
		location.reload();
	}

	function transferOwner() {
		var newO = document.getElementById('newOwner').value;
		creditCommons.transferGroupOwner(myGroupID, newOwner);
		location.reload();
	}

	var newGroup = creditCommons.NewGroup({}, {
		fromBlock : 1400000,
		toBlock : 'latest'
	}, function(error, result) {
		var row = "";
		var d;
		newGroup.watch(function(error, result) {
			d = new Date(result.args._NGTimeStamp * 1000);
			row += "<hr/>Created: " + d + "<br/>" + "Group ID: <b>"
					+ result.args._groupIDN + "</b> Group Name: <b>"
					+ result.args._groupNameN + "</b><br/>Owner: "
					+ result.args._creator + "<br/>";
			document.getElementById('listNewGroups').innerHTML = row;
		});
	});

	var modifiedGroup = creditCommons.ModifyGroup({}, {
		fromBlock : 1400000,
		toBlock : 'latest'
	}, function(error, result) {
		var row = "";
		var d;
		modifiedGroup.watch(function(error, result) {
			d = new Date(result.args._MGTimeStamp * 1000);
			row += "<hr/>Modified: " + Date(result.args._MGTimeStamp) + "<br/>"
					+ "Group ID: <b>" + result.args._groupIDM
					+ "</b> Group Name: <b>" + result.args._groupNameM
					+ "</b><br/>Owner: " + result.args._modifier + "<br/>";
			document.getElementById('listModGroups').innerHTML = row;
		});
	});
</script>
<style>
.navbar {
	margin-bottom: 0;
	border-radius: 0;
}
</style>
</head>
<body>
	<nav class="navbar navbar-inverse">
		<div class="container-fluid">
			<div class="navbar-header">
				<a class="navbar-brand" href="http://creditcommons.net/">Credit
					Commons</a>
			</div>
			<ul class="nav navbar-nav">
				<li><a href="index.html">Home</a></li>
				<li><a href="transactions.html">Transactions</a></li>
				<li class="active"><a href="groups.html">Groups</a></li>
				<li><a href="members.html">Members</a></li>
				<li><a href="posts.html">Posts</a></li>
				<li><a href="polls.html">Polls</a></li>
			</ul>
		</div>
	</nav>
	<div class="container bg-3 text-center">
		<small><p class="bg-info" id="me"></p></small>
		<div class="row">
			<div class="col-sm-12">
				<h3>My Group</h3>
				<form class="form-horizontal" role="form">
					<div class="form-group">
						<label class="control-label col-sm-4" for="groupOwner">Group
							Owner:</label>
						<div class="col-sm-8">
							<output class="form-control" id="groupOwner"></output>
						</div>
					</div>
					<div class="form-group">
						<label class="control-label col-sm-4" for="groupID">Group
							ID:</label>
						<div class="col-sm-4">
							<output class="form-control" id="groupID"></output>
						</div>
					</div>
					<div class="form-group">
						<label class="control-label col-sm-4" for="groupName">Group
							Name:</label>
						<div class="col-sm-4">
							<output class="form-control" id="groupName"></output>
						</div>
					</div>
					<div class="form-group">
						<label class="control-label col-sm-4" for="currency">Group
							Currency:</label>
						<div class="col-sm-4">
							<output class="form-control" id="currency"></output>
						</div>
					</div>
					<div class="form-group">
						<label class="control-label col-sm-4" for="rate">Currency
							Rate:</label>
						<div class="col-sm-4">
							<output class="form-control" id="rate"></output>
						</div>
					</div>
					<div class="form-group">
						<label class="control-label col-sm-4" for="debitLimitG">Default
							Debit Limit:</label>
						<div class="col-sm-4">
							<output class="form-control" id="debitLimitG"></output>
						</div>
					</div>
					<div class="form-group">
						<label class="control-label col-sm-4" for="creditLimitG">Default
							Credit Limit:</label>
						<div class="col-sm-4">
							<output class="form-control" id="creditLimitG"></output>
						</div>
					</div>
					<div class="form-group">
						<label class="control-label col-sm-4" for="open">Open:</label>
						<div class="col-sm-4">
							<output class="form-control" id="open"></output>
						</div>
					</div>
				</form>

				<button type="submit" class="btn btn-default" onClick="resign();">Resign
					from your Group</button>
				<hr>
				<form class="form-horizontal" role="form">
					<div class="form-group">
						<label class="control-label col-sm-4" for="groupToJoin">Join
							Group:</label>
						<div class="col-sm-4">
							<input type="text" class="form-control" id="groupToJoin"
								placeholder="Enter the group ID">
						</div>
					</div>
				</form>
				<button type="submit" class="btn btn-default" onClick="joinGroup();">Join</button>
				<hr />
				<div id="owner_ID"></div>
				<form class="form-horizontal" role="form">
					<div class="form-group">
						<label class="control-label col-sm-4" for="newOwner">Transfer
							Ownership:</label>
						<div class="col-sm-8">
							<input type="text" class="form-control" id="newOwner"
								placeholder="Enter the new owner address">
						</div>
					</div>
				</form>
				<button type="submit" class="btn btn-default" onClick="transfer();">Transfer</button>
				<hr />
			</div>
		</div>
		<div class="row">
			<div class="col-sm-6">
				<h4>Create Group</h4>
				<div>Only if you do not belong to one group</div>
				<form class="form-horizontal" role="form">
					<div class="form-group">
						<label class="control-label col-sm-4" for="CgroupName">Group
							Name:</label>
						<div class="col-sm-4">
							<input class="form-control" id="CgroupName">
						</div>
					</div>
					<div class="form-group">
						<label class="control-label col-sm-4" for="Ccurrency">Group
							Currency:</label>
						<div class="col-sm-4">
							<input class="form-control" id="Ccurrency">
						</div>
					</div>
					<div class="form-group">
						<label class="control-label col-sm-4" for="Crate">Currency
							Rate:</label>
						<div class="col-sm-4">
							<input class="form-control" id="Crate">
						</div>
					</div>
					<div class="form-group">
						<label class="control-label col-sm-4" for="CdebitLimit">Default
							Debit Limit:</label>
						<div class="col-sm-4">
							<input class="form-control" id="CdebitLimitG">
						</div>
					</div>
					<div class="form-group">
						<label class="control-label col-sm-4" for="CcreditLimit">Default
							Credit Limit:</label>
						<div class="col-sm-4">
							<input class="form-control" id="CcreditLimitG">
						</div>
					</div>
					<div class="form-group">
						<label class="control-label col-sm-4" for="Copen">Open:</label>
						<div class="col-sm-4">
							<input class="form-control" type="checkbox" id="Copen">
						</div>
					</div>
				</form>
				<button type="submit" class="btn btn-default"
					onClick="createGroup();">Create</button>
			</div>
			<div class="col-sm-6">
				<h4>Modify my Group</h4>
				<div>Only owner</div>
				<form class="form-horizontal" role="form">
					<div class="form-group">
						<label class="control-label col-sm-4" for="MgroupName">New
							Group Name:</label>
						<div class="col-sm-4">
							<input class="form-control" id="MgroupName">
						</div>
					</div>
					<div class="form-group">
						<label class="control-label col-sm-4" for="Mcurrency">New
							Group Currency:</label>
						<div class="col-sm-4">
							<input class="form-control" id="Mcurrency">
						</div>
					</div>
					<div class="form-group">
						<label class="control-label col-sm-4" for="Mrate">New
							Currency Rate:</label>
						<div class="col-sm-4">
							<input class="form-control" id="Mrate">
						</div>
					</div>
					<div class="form-group">
						<label class="control-label col-sm-4" for="MdebitLimit">New
							Default Debit Limit:</label>
						<div class="col-sm-4">
							<input class="form-control" id="MdebitLimitG">
						</div>
					</div>
					<div class="form-group">
						<label class="control-label col-sm-4" for="McreditLimit">New
							Default Credit Limit:</label>
						<div class="col-sm-4">
							<input class="form-control" id="McreditLimitG">
						</div>
					</div>
					<div class="form-group">
						<label class="control-label col-sm-4" for="Mopen"> Open:</label>
						<div class="col-sm-4">
							<input class="form-control" type="checkbox" id="Mopen">
						</div>
					</div>
				</form>
				<button type="submit" class="btn btn-default"
					onClick="modifyGroup();">Modify</button>
			</div>
			<div class="row">
				<div class="col-sm-12">
					<hr />
					<h3>Groups</h3>
					<p id="numberG"></p>
					<div class="text-left" id="listGroups"></div>

					<h3>Events</h3>
					<h4>New Groups</h4>
					<div class="text-left" id="listNewGroups"></div>
					<h4>Modified Groups</h4>
					<div class="text-left" id="listModGroups"></div>

				</div>
			</div>
		</div>

		<div class="panel-footer">
			<p>
				<img
					src="https://trancsitu.files.wordpress.com/2014/05/ethereum-logo.png"
					width="20" align="top" /> <i>Powered by ethereum</i>
			</p>
			<a rel="license"
				href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img
				alt="Creative Commons License" style="border-width: 0"
				src="https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png" /></a><br />This
			work is licensed under a <a rel="license"
				href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative
				Commons Attribution-NonCommercial-ShareAlike 4.0 International
				License</a>.
		</div>
</body>
</html>
